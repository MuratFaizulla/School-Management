generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Администраторы системы
model Admin {
  id       String @id           // Уникальный ID администратора
  username String @unique      // Логин администратора
}

// Учителя школы
model Teacher {
  id        String    @id                     // Уникальный ID учителя
  username  String    @unique                 // Логин учителя
  name      String                            // Имя
  surname   String                            // Фамилия
  email     String?   @unique                 // Email (необязательный)
  createdAt DateTime  @default(now())         // Дата создания записи
  
  // Связи с другими таблицами
  subjects  Subject[]                         // Предметы, которые ведет учитель
  lessons   Lesson[]                          // Уроки учителя
  classes   Class[]                           // Классы, которыми руководит
  
  // События где учитель является тим-лидером
  eventsAsTeamLeader Event[] @relation("TeamLeader")
  
  // События где учитель является участником
  eventParticipations EventParticipant[] @relation("Participants")
}

// Классы (например 9А, 10Б)
model Class {
  id           Int    @id @default(autoincrement())  // Уникальный ID класса
  name         String @unique                        // Название класса (9А, 10Б и т.д.)
  gradeLevel   Int                                   // Номер параллели (9, 10, 11 и т.д.)
  capacity     Int                                   // Максимальное количество учеников
  supervisorId String?                               // ID классного руководителя
  supervisor   Teacher?       @relation(fields: [supervisorId], references: [id])    // Классный руководитель
  lessons      Lesson[]                              // Уроки класса
  events       Event[]                               // События контроля класса
  announcements Announcement[]                       // Объявления для класса
}

// Учебные предметы
model Subject {
  id       Int       @id @default(autoincrement())  // Уникальный ID предмета
  name     String    @unique                        // Название предмета (математика, история и т.д.)
  teachers Teacher[]                                // Учителя, ведущие предмет
  lessons  Lesson[]                                 // Уроки по предмету
}

// Уроки в расписании
model Lesson {
  id        Int      @id @default(autoincrement())  // Уникальный ID урока
  name      String                                  // Название урока
  day       Day                                     // День недели
  startTime DateTime                                // Время начала
  endTime   DateTime                                // Время окончания
  subjectId   Int                                   // ID предмета
  subject     Subject      @relation(fields: [subjectId], references: [id])     // Предмет урока
  classId     Int                                   // ID класса
  class       Class        @relation(fields: [classId], references: [id])       // Класс, у которого урок
  teacherId   String                                // ID учителя
  teacher     Teacher      @relation(fields: [teacherId], references: [id])     // Учитель урока
}

// Школьные события / Контроль уроков (ПЛАНИРОВАНИЕ контроля)
model Event {
  id          Int      @id @default(autoincrement()) // Уникальный ID события
  title       String                                 // Название события
  description String                                 // Описание события
  startTime   DateTime                               // Время начала контроля
  endTime     DateTime                               // Время окончания контроля
  controllerType ControllerType                      // ТИП контролера (директор, завуч и т.д.)
  
  // Тим-лидер (руководитель группы учителей)
  teamLeaderId String                                // ID учителя тим-лидера
  teamLeader   Teacher  @relation("TeamLeader", fields: [teamLeaderId], references: [id]) // Тим-лидер
  
  // Участники (массив учителей)
  participants EventParticipant[]                    // Участники контроля
  
  // Класс
  classId     Int                                    // ID класса (ОБЯЗАТЕЛЬНО)
  class       Class    @relation(fields: [classId], references: [id])   // Класс события
  
  feedback    Feedback?                              // Детальная обратная связь после контроля
}

// Промежуточная таблица для участников события (many-to-many)
model EventParticipant {
  id        Int      @id @default(autoincrement())
  eventId   Int                                      // ID события
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  teacherId String                                   // ID учителя-участника
  teacher   Teacher  @relation("Participants", fields: [teacherId], references: [id])
  
  @@unique([eventId, teacherId])                     // Один учитель не может быть добавлен дважды в одно событие
}

// Лист наблюдения еженедельного планирования урока (ПОСЛЕ контроля)
model Feedback {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  // Основная информация
  observerName    String
  observationDate DateTime
  observationTime String
  subject         String
  grade           String

  // Таблица 1
  hasTeamLeader           Boolean
  hasAgenda               Boolean
  isProcessDocumented     Boolean
  teachersShowInterest    Boolean
  teachersGiveSuggestions Boolean
  effectiveCollaboration  Boolean
  analyzePreviousLessons  Boolean

  commentsTable1        String?
  recommendationsTable1 String?

  // Таблица 2
  useLessonReflection     Boolean
  useStudentAchievements  Boolean
  useExternalAssessment   Boolean
  usePedagogicalDecisions Boolean
  useLessonVisitResults   Boolean
  useStudentFeedback      Boolean
  useOtherData            Boolean
  otherDataDescription    String?

  commentsTable2        String?
  recommendationsTable2 String?

  // Таблица 3
  discussGoalsAlignment      Boolean
  adaptLearningGoals         Boolean
  selectAppropriateResources Boolean
  selectDifferentiatedStrategies Boolean
  selectEngagingTasks        Boolean
  discussDescriptors         Boolean
  allocateTime               Boolean
  selectFormativeAssessment  Boolean
  planReflection             Boolean
  useICTTools                Boolean
  defineHomework             Boolean
  considerSafety             Boolean

  commentsTable3        String?
  recommendationsTable3 String?

  // Связь с событием
  eventId Int    @unique
  event   Event  @relation(fields: [eventId], references: [id])
}

// Объявления
model Announcement {
  id          Int      @id @default(autoincrement()) // Уникальный ID объявления
  title       String                                 // Заголовок объявления
  description String                                 // Текст объявления
  date        DateTime                               // Дата публикации
  classId Int?                                       // ID класса (необязательно, может быть общешкольное)
  class   Class? @relation(fields: [classId], references: [id])              // Класс, для которого объявление
}

// Перечисление: дни недели
enum Day {
  MONDAY      // Понедельник
  TUESDAY     // Вторник
  WEDNESDAY   // Среда
  THURSDAY    // Четверг
  FRIDAY      // Пятница
}

// Перечисление: кто контролирует урок
enum ControllerType {
  DIRECTOR         // Директор  	Тусупжанов Айдын Елеусызович
  DEPUTY_UC        // Заместитель директора по УР (Deputy for Academic Work)  	Ахатаева Жадыра Оразхановна
  DEPUTY_VP        // Заместитель директора по ВР (Deputy for Educational Work)  Мурзабеков Айбар Бейбитович
  DEPUTY_NMR       // Заместитель директора по НМР (Deputy for Scientific-Methodical Work)  Токтамысова Ибалы Талгатовна
  DEPUTY_VS        // Заместитель директора по ВС (Deputy for Internal Control)  Тажибаев Асхат Куатович
}